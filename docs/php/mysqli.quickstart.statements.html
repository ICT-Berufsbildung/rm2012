<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Executing statements</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="mysqli.quickstart.connections.html">Connections</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="mysqli.quickstart.prepared-statements.html">Prepared Statements</a></div>
 <div class="up"><a href="mysqli.quickstart.html">Quickstart</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="mysqli.quickstart.statements" class="section">
  <h2 class="title">Executing statements</h2>
  <p class="para">
   Statements can be executed by help of the
   <span class="function"><a href="mysqli.query.html" class="function">mysqli_query()</a></span>, <span class="function"><a href="mysqli.real-query.html" class="function">mysqli_real_query()</a></span>
   and <span class="function"><a href="mysqli.multi-query.html" class="function">mysqli_multi_query()</a></span> function.
   The <span class="function"><a href="mysqli.query.html" class="function">mysqli_query()</a></span> function is the most
   commonly used one. It combines executing statement and doing a
   buffered fetch of its result set, if any, in one call.
   Calling <span class="function"><a href="mysqli.query.html" class="function">mysqli_query()</a></span> is identical to
   calling <span class="function"><a href="mysqli.real-query.html" class="function">mysqli_real_query()</a></span>
   followed by <span class="function"><a href="mysqli.store-result.html" class="function">mysqli_store_result()</a></span>.
  </p>
  <p class="para">
   The <span class="function"><a href="mysqli.multi-query.html" class="function">mysqli_multi_query()</a></span> function is used
   with Multiple Statements and is described elsewhere.
  </p>
  <p class="para">
   <div class="example" id="example-1555">
    <p><b>Example #1 Bad coding style</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
$mysqli&nbsp;=&nbsp;new&nbsp;mysqli("example.com",&nbsp;"user",&nbsp;"password",&nbsp;"database");<br />if&nbsp;($mysqli-&gt;connect_errno))<br />&nbsp;echo&nbsp;"Failed&nbsp;to&nbsp;connect&nbsp;to&nbsp;MySQL:&nbsp;("&nbsp;.&nbsp;$mysqli-&gt;connect_errno&nbsp;.&nbsp;")&nbsp;"&nbsp;.&nbsp;$mysqli-&gt;connect_error;<br /><br />if&nbsp;(!$mysqli-&gt;query("DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test")&nbsp;||<br />&nbsp;&nbsp;&nbsp;&nbsp;!$mysqli-&gt;query("CREATE&nbsp;TABLE&nbsp;test(id&nbsp;INT)")&nbsp;||<br />&nbsp;&nbsp;&nbsp;&nbsp;!$mysqli-&gt;query("INSERT&nbsp;INTO&nbsp;test(id)&nbsp;VALUES&nbsp;(1)"))<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"Table&nbsp;creation&nbsp;failed:&nbsp;("&nbsp;.&nbsp;$mysqli-&gt;errno&nbsp;.&nbsp;")&nbsp;"&nbsp;.&nbsp;$mysqli-&gt;error;</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <em class="emphasis">Buffered result sets</em>
  </p>
  <p class="para">
   After statement execution results can be retrieved at once to be buffered
   by the client or by read row by row. Client-side result set buffering
   allows the server to free resources associated with the statement
   results as early as possible. Generally speaking, clients are slow
   consuming result sets. Therefore, it is recommended to use buffered
   result sets. <span class="function"><a href="mysqli.query.html" class="function">mysqli_query()</a></span> combines statement
   execution and result set buffering.
  </p>
  <p class="para">
   PHP applications can navigate freely through buffered results.
   Nagivation is fast because the result sets is hold in client memory.
   Please, keep in mind that it is often easier to scale by client than
   it is to scale the server.
  </p>
  <p class="para">
   <div class="example" id="example-1556">
    <p><b>Example #2 Navigation through buffered results</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
$mysqli&nbsp;=&nbsp;new&nbsp;mysqli("example.com",&nbsp;"user",&nbsp;"password",&nbsp;"database");<br />if&nbsp;($mysqli-&gt;connect_errno))<br />&nbsp;echo&nbsp;"Failed&nbsp;to&nbsp;connect&nbsp;to&nbsp;MySQL:&nbsp;("&nbsp;.&nbsp;$mysqli-&gt;connect_errno&nbsp;.&nbsp;")&nbsp;"&nbsp;.&nbsp;$mysqli-&gt;connect_error;<br /><br />if&nbsp;(!$mysqli-&gt;query("DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test")&nbsp;||<br />&nbsp;&nbsp;&nbsp;&nbsp;!$mysqli-&gt;query("CREATE&nbsp;TABLE&nbsp;test(id&nbsp;INT)")&nbsp;||<br />&nbsp;&nbsp;&nbsp;&nbsp;!$mysqli-&gt;query("INSERT&nbsp;INTO&nbsp;test(id)&nbsp;VALUES&nbsp;(1),&nbsp;(2),&nbsp;(3)"))<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"Table&nbsp;creation&nbsp;failed:&nbsp;("&nbsp;.&nbsp;$mysqli-&gt;errno&nbsp;.&nbsp;")&nbsp;"&nbsp;.&nbsp;$mysqli-&gt;error;<br /><br />$res&nbsp;=&nbsp;$mysqli-&gt;query("SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;ASC");<br /><br />echo&nbsp;"Reverse&nbsp;order...\n";<br />for&nbsp;($row_no&nbsp;=&nbsp;$res-&gt;num_rows&nbsp;-&nbsp;1;&nbsp;$row_no&nbsp;&gt;=&nbsp;0;&nbsp;$row_no--)&nbsp;{<br />&nbsp;&nbsp;$res-&gt;data_seek($row_no);<br />&nbsp;&nbsp;$row&nbsp;=&nbsp;$res-&gt;fetch_assoc();<br />&nbsp;&nbsp;echo&nbsp;"&nbsp;id&nbsp;=&nbsp;"&nbsp;.&nbsp;$row['id']&nbsp;.&nbsp;"\n";<br />}<br /><br />echo&nbsp;"Result&nbsp;set&nbsp;order...\n";<br />$res-&gt;data_seek(0);<br />while&nbsp;($row&nbsp;=&nbsp;$res-&gt;fetch_assoc())<br />&nbsp;echo&nbsp;"&nbsp;id&nbsp;=&nbsp;"&nbsp;.&nbsp;$row['id']&nbsp;.&nbsp;"\n";</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Reverse order...
 id = 3
 id = 2
 id = 1
Result set order...
 id = 1
 id = 2
 id = 3
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   <em class="emphasis">Unbuffered result sets</em>
  </p>
  <p class="para">
   If client memory is a short resource and freeing server resources as
   early as possible to keep server load low is not needed,
   unbuffered results can be used. Scrolling through unbuffered results
   is not possible before all rows have been read.
  </p>
  <p class="para">
   <div class="example" id="example-1557">
    <p><b>Example #3 Navigation through buffered results</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
$mysqli-&gt;real_query("SELECT&nbsp;id&nbsp;FROM&nbsp;test&nbsp;ORDER&nbsp;BY&nbsp;id&nbsp;ASC");<br />$res&nbsp;=&nbsp;$mysqli-&gt;use_result();<br /><br />echo&nbsp;"Result&nbsp;set&nbsp;order...\n";<br />while&nbsp;($row&nbsp;=&nbsp;$res-&gt;fetch_assoc())<br />&nbsp;echo&nbsp;"&nbsp;id&nbsp;=&nbsp;"&nbsp;.&nbsp;$row['id']&nbsp;.&nbsp;"\n";</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <em class="emphasis">Result set values data types</em>
  </p>
  <p class="para">
   The <span class="function"><a href="mysqli.query.html" class="function">mysqli_query()</a></span>, <span class="function"><a href="mysqli.real-query.html" class="function">mysqli_real_query()</a></span>
   and <span class="function"><a href="mysqli.multi-query.html" class="function">mysqli_multi_query()</a></span> functions are used to execute
   non-prepared statements.  At the level of the MySQL Client Server Protocol
   the command <i>COM_QUERY</i> and the text protocol are used
   for statement execution. With the text protocol, the MySQL server converts
   all data of a result sets into strings before sending. This conversion is done
   regardless of the SQL result set column data type. The mysql client libraries
   receive all column values as strings. No further client-side casting is done
   to convert columns back to their native types. Instead, all values are
   provided as PHP strings.
  </p>
  <p class="para">
   <div class="example" id="example-1558">
    <p><b>Example #4 Text protocol returns strings by default</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
$mysqli&nbsp;=&nbsp;new&nbsp;mysqli("example.com",&nbsp;"user",&nbsp;"password",&nbsp;"database");<br />if&nbsp;($mysqli-&gt;connect_errno))<br />&nbsp;echo&nbsp;"Failed&nbsp;to&nbsp;connect&nbsp;to&nbsp;MySQL:&nbsp;("&nbsp;.&nbsp;$mysqli-&gt;connect_errno&nbsp;.&nbsp;")&nbsp;"&nbsp;.&nbsp;$mysqli-&gt;connect_error;<br /><br />if&nbsp;(!$mysqli-&gt;query("DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test")&nbsp;||<br />&nbsp;&nbsp;&nbsp;&nbsp;!$mysqli-&gt;query("CREATE&nbsp;TABLE&nbsp;test(id&nbsp;INT,&nbsp;label&nbsp;CHAR(1))")&nbsp;||<br />&nbsp;&nbsp;&nbsp;&nbsp;!$mysqli-&gt;query("INSERT&nbsp;INTO&nbsp;test(id,&nbsp;label)&nbsp;VALUES&nbsp;(1,&nbsp;'a')"))<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"Table&nbsp;creation&nbsp;failed:&nbsp;("&nbsp;.&nbsp;$mysqli-&gt;errno&nbsp;.&nbsp;")&nbsp;"&nbsp;.&nbsp;$mysqli-&gt;error;<br /><br />$res&nbsp;=&nbsp;$mysqli-&gt;query("SELECT&nbsp;id,&nbsp;label&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;1");<br />$row&nbsp;=&nbsp;$res-&gt;fetch_assoc();<br /><br />printf("id&nbsp;=&nbsp;%s&nbsp;(%s)\n",&nbsp;$row['id'],&nbsp;gettype($row['id']));<br />printf("label&nbsp;=&nbsp;%s&nbsp;(%s)\n",&nbsp;$row['label'],&nbsp;gettype($row['label']));</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
id = 1 (string)
label = a (string)
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   It is possible to convert integer and float columns back to PHP numbers by setting the
   <i>MYSQLI_OPT_INT_AND_FLOAT_NATIVE</i> connection option,
   if using the mysqlnd libary. If set, the mysqlnd library will
   check the result set meta data column types and convert numeric SQL columns
   to PHP numbers, if the PHP data type value range allows for it.
   This way, for example, SQL INT columns are returned as integers.
  </p>
  <p class="para">
   <div class="example" id="example-1559">
    <p><b>Example #5 Native data types with mysqlnd and conneciton option</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
$mysqli&nbsp;=&nbsp;mysqli_init();<br />$mysqli-&gt;options(MYSQLI_OPT_INT_AND_FLOAT_NATIVE,&nbsp;1);<br />$mysqli-&gt;real_connect("example.com",&nbsp;"user",&nbsp;"password",&nbsp;"database");<br />if&nbsp;($mysqli-&gt;connect_errno))<br />&nbsp;echo&nbsp;"Failed&nbsp;to&nbsp;connect&nbsp;to&nbsp;MySQL:&nbsp;("&nbsp;.&nbsp;$mysqli-&gt;connect_errno&nbsp;.&nbsp;")&nbsp;"&nbsp;.&nbsp;$mysqli-&gt;connect_error;<br /><br />if&nbsp;(!$mysqli-&gt;query("DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test")&nbsp;||<br />&nbsp;&nbsp;&nbsp;&nbsp;!$mysqli-&gt;query("CREATE&nbsp;TABLE&nbsp;test(id&nbsp;INT,&nbsp;label&nbsp;CHAR(1))")&nbsp;||<br />&nbsp;&nbsp;&nbsp;&nbsp;!$mysqli-&gt;query("INSERT&nbsp;INTO&nbsp;test(id,&nbsp;label)&nbsp;VALUES&nbsp;(1,&nbsp;'a')"))<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"Table&nbsp;creation&nbsp;failed:&nbsp;("&nbsp;.&nbsp;$mysqli-&gt;errno&nbsp;.&nbsp;")&nbsp;"&nbsp;.&nbsp;$mysqli-&gt;error;<br /><br />$res&nbsp;=&nbsp;$mysqli-&gt;query("SELECT&nbsp;id,&nbsp;label&nbsp;FROM&nbsp;test&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;1");<br />$row&nbsp;=&nbsp;$res-&gt;fetch_assoc();<br /><br />printf("id&nbsp;=&nbsp;%s&nbsp;(%s)\n",&nbsp;$row['id'],&nbsp;gettype($row['id']));<br />printf("label&nbsp;=&nbsp;%s&nbsp;(%s)\n",&nbsp;$row['label'],&nbsp;gettype($row['label']));</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
id = 1 (string)
label = a (string)
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   <em class="emphasis">See also</em>
  </p>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="mysqli.construct.html" class="link"> <span class="methodname"><a href="mysqli.construct.html" class="methodname">mysqli::__construct()</a></span></a></li>
    <li class="member"><a href="mysqli.init.html" class="link"> <span class="methodname"><a href="mysqli.init.html" class="methodname">mysqli::init()</a></span></a></li>
    <li class="member"><a href="mysqli.options.html" class="link"> <span class="methodname"><a href="mysqli.options.html" class="methodname">mysqli::options()</a></span></a></li>
    <li class="member"><a href="mysqli.real-connect.html" class="link"> <span class="methodname"><a href="mysqli.real-connect.html" class="methodname">mysqli::real_connect()</a></span></a></li>
    <li class="member"><a href="mysqli.query.html" class="link"> <span class="methodname"><a href="mysqli.query.html" class="methodname">mysqli::query()</a></span></a></li>
    <li class="member"><a href="mysqli.multi-query.html" class="link"> <span class="methodname"><a href="mysqli.multi-query.html" class="methodname">mysqli::multi_query()</a></span></a></li>
    <li class="member"><a href="mysqli.use-result.html" class="link"> <span class="methodname"><a href="mysqli.use-result.html" class="methodname">mysqli::use_result()</a></span></a></li>
    <li class="member"><a href="mysqli.store-result.html" class="link"> <span class="methodname"><a href="mysqli.store-result.html" class="methodname">mysqli::store_result()</a></span></a></li>
    <li class="member"><a href="mysqli-result.free.html" class="link"> <span class="methodname"><a href="mysqli-result.free.html" class="methodname">mysqli_result::free()</a></span></a></li>
   </ul>
  </p>
 </div><hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="mysqli.quickstart.connections.html">Connections</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="mysqli.quickstart.prepared-statements.html">Prepared Statements</a></div>
 <div class="up"><a href="mysqli.quickstart.html">Quickstart</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
