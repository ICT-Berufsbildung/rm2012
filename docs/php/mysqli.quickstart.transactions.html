<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>API support for transactions</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="mysqli.quickstart.multiple-statement.html">Multiple Statements</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="mysqli.quickstart.metadata.html">Metadata</a></div>
 <div class="up"><a href="mysqli.quickstart.html">Quickstart</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="mysqli.quickstart.transactions" class="section">
  <h2 class="title">API support for transactions</h2>
  <p class="para">
   The MySQL server supports transactions depending on the storage engine used.
   Since MySQL [TODO]x.y[TODO] the default storage engine is InnoDB.
   InnoDB has full ACID transaction support.
  </p>
  <p class="para">
   Transactions can either be controlled using SQL or API calls.
   It is recommended to use API calls for enabling and disabling the
   auto commit mode and for comitting and rolling back transactions.
  </p>
  <p class="para">
   <div class="example" id="example-1575">
    <p><b>Example #1 Setting auto commit mode with SQL and through the API</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
$mysqli&nbsp;=&nbsp;new&nbsp;mysqli("example.com",&nbsp;"user",&nbsp;"password",&nbsp;"database");<br />if&nbsp;($mysqli-&gt;connect_errno))<br />&nbsp;echo&nbsp;"Failed&nbsp;to&nbsp;connect&nbsp;to&nbsp;MySQL:&nbsp;("&nbsp;.&nbsp;$mysqli-&gt;connect_errno&nbsp;.&nbsp;")&nbsp;"&nbsp;.&nbsp;$mysqli-&gt;connect_error;<br /><br />/*&nbsp;Recommended:&nbsp;using&nbsp;API&nbsp;to&nbsp;control&nbsp;transactional&nbsp;settings&nbsp;*/<br />$mysqli-&gt;autocommit(false);<br /><br />/*&nbsp;Won't&nbsp;be&nbsp;monitored&nbsp;and&nbsp;recognized&nbsp;by&nbsp;the&nbsp;replication&nbsp;and&nbsp;the&nbsp;load&nbsp;balancing&nbsp;plugin&nbsp;*/<br />if&nbsp;(!$mysqli-&gt;query('SET&nbsp;AUTOCOMMIT&nbsp;=&nbsp;0'))<br />&nbsp;&nbsp;echo&nbsp;"Query&nbsp;failed:&nbsp;("&nbsp;.&nbsp;$mysqli-&gt;errno&nbsp;.&nbsp;")&nbsp;"&nbsp;.&nbsp;$mysqli-&gt;error;</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   Optional feature packages, such as the replication and load balancing plugin,
   can easily monitor API calls. The replication plugin offers transaction
   aware load balancing, if transactions are controlled with API calls.
   Transaction aware load balancing is not available if SQL statements are
   used for setting auto commit mode, committing or rolling back a transaction.
  </p>
  <p class="para">
   <div class="example" id="example-1576">
    <p><b>Example #2 Commit and rollback</b></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
$mysqli&nbsp;=&nbsp;new&nbsp;mysqli("example.com",&nbsp;"user",&nbsp;"password",&nbsp;"database");<br />$mysqli-&gt;autocommit(false);<br /><br />$mysqli-&gt;query("INSERT&nbsp;INTO&nbsp;test(id)&nbsp;VALUES&nbsp;(1)");<br />$mysqli-&gt;rollback();<br /><br />$mysqli-&gt;query("INSERT&nbsp;INTO&nbsp;test(id)&nbsp;VALUES&nbsp;(2)");<br />$mysqli-&gt;commit();</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   Please note, that the MySQL server cannot roll back all statements.
   Some statements cause am implicit commit.
  </p>
  <p class="para">
   <em class="emphasis">See also</em>
  </p>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="mysqli.autocommit.html" class="link"> <span class="methodname"><a href="mysqli.autocommit.html" class="methodname">mysqli::autocommit()</a></span></a></li>
    <li class="member"><a href="mysqli.commit.html" class="link"> <span class="methodname"><b>mysqli_result::commit()</b></span></a></li>
    <li class="member"><a href="mysqli.rollback.html" class="link"> <span class="methodname"><b>mysqli_result::rollback()</b></span></a></li>
   </ul>
  </p>
 </div><hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="mysqli.quickstart.multiple-statement.html">Multiple Statements</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="mysqli.quickstart.metadata.html">Metadata</a></div>
 <div class="up"><a href="mysqli.quickstart.html">Quickstart</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
